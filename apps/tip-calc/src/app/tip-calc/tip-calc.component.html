<div class="p-4 sm:p-8 max-w-md mx-auto flex flex-col space-y-6 text-base">
  <h1 class="text-2xl font-bold text-center text-primary">Tip Calculator</h1>

  <!-- Bill -->
  <div class="space-y-2">
    <label class="text-lg"  for="billAmount" hlmLabel>Bill amount</label>
    <div class="relative">
      <span aria-hidden="true" class="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground">$</span>
      <input
        id="billAmount"
        hlmInput
        class="pl-7 min-h-[3em]"
        type="number"
        inputmode="decimal"
        step="0.01"
        min="0"
        placeholder="0.00"
        autocomplete="off"
        enterkeyhint="done"
        [ngModel]="bill()"
        (ngModelChange)="onBillInput($event)"
        aria-describedby="bill-hint"
      />
    </div>
    <p id="bill-hint" class="sr-only">Enter the bill amount in dollars and cents.</p>
  </div>

  <!-- Tip % -->
  <fieldset class="space-y-3">
    <legend id="tip-percent" class="text-lg font-medium">Tip %</legend>

    <hlm-radio-group
      class="grid grid-cols-3 gap-3"
      aria-labelledby="tip-percent"
      [value]="useCustom() ? 'custom' : selectedPercent()"
      (valueChange)="($event === 'custom') ? chooseCustom() : choosePreset($event)"
    >
      @for (pct of tipPercentages.slice(0, 5); track pct) {
        <label class="flex">
          <hlm-radio [value]="pct" aria-label="{{ pct }} percent" />
          <span
            hlmBtn
            [variant]="(!useCustom() && selectedPercent() === pct) ? 'default' : 'outline'"
            class="w-full rounded-xl min-h-12"
          >
            <span class="text-lg font-semibold">{{ pct }}%</span>
          </span>
        </label>
      }

      <label class="flex">
        <hlm-radio value="custom" aria-label="Custom percent" />
        <span
          hlmBtn
          (click)="chooseCustom()"
          [variant]="useCustom() ? 'default' : 'outline'"
          class="w-full rounded-xl min-h-12"
        >
          <span class="font-semibold">Custom %</span>
        </span>
      </label>
    </hlm-radio-group>

    @if (useCustom()) {
      <div class="px-1 space-y-2">
        <div class="flex items-center justify-between text-sm">
          <span class="font-semibold" id="custom-tip-label">Custom tip</span>
          <span aria-live="polite">{{ customPercent() }}%</span>
        </div>
        <hlm-slider
          aria-labelledby="custom-tip-label"
          [min]="0"
          [max]="50"
          [step]="1"
          [value]="customPercent()"
          (valueChange)="onCustomInput($event)"
          [attr.aria-valuetext]="customPercent() + ' percent'"
        />
      </div>
    }
  </fieldset>

  <!-- Summary -->
  <section class="rounded-2xl border p-4 shadow-sm space-y-6 card" aria-label="Summary">
    <div class="space-y-2">
      <div class="flex justify-between">
        <span class="text-muted-foreground">Bill</span>
        <span>{{ subtotal() | currency }}</span>
      </div>

      <div class="flex justify-between">
        <span class="text-lg text-primary font-bold">Tip</span>
        <span class="text-xl text-primary font-bold">{{ selectedTipAmount() | currency }}</span>
      </div>

      <div class="flex justify-between items-baseline pt-1 border-t">
        <span class="font-bold text-lg">
          Total <span class="text-muted-foreground font-normal" *ngIf="roundMode()">&nbsp;(Rounded)</span>
        </span>
        <span class="font-bold text-xl">{{ totalRounded() | currency }}</span>
      </div>
    </div>

  </section>
  <div class="space-y-2">
    <div id="round-total-label" class="text-lg font-medium">Round total</div>
    <div class="flex gap-2" aria-labelledby="round-total-label">
      @for (mode of roundModes; track mode) {
        <button
          hlmBtn
          size="lg"
          class="capitalize min-w-20"
          [variant]="roundMode() === mode ? 'default' : 'outline'"
          (click)="setRoundMode(mode)"
        >
          {{ mode | titlecase }}
        </button>
      }
    </div>
  </div>

  <!-- Split -->
  <div class="space-y-2">
    <div class="text-lg font-medium">Split bill</div>

    @if (people() > 1) {
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <button
            hlmBtn
            variant="outline"
            size="lg"
            (click)="changePeople(-1)"
            [disabled]="people() <= 1"
            aria-label="Decrease people"
            aria-controls="people-count"
          >âˆ’</button>

          <div id="people-count" class="min-w-[2.5rem] text-center text-lg font-medium" aria-live="polite">
            {{ people() }}
          </div>

          <button
            hlmBtn
            variant="outline"
            size="lg"
            (click)="changePeople(1)"
            aria-label="Increase people"
            aria-controls="people-count"
          >+</button>
        </div>
      </div>

      <div class="space-y-1">
        <div class="flex justify-between">
          <span class="text-muted-foreground">Tip per person</span>
          <span class="font-medium">{{ tipPerPerson() | currency }}</span>
        </div>
        <div class="flex justify-between">
          <span class="font-semibold">Total per person</span>
          <span class="font-semibold">{{ perPerson() | currency }}</span>
        </div>
      </div>
    } @else {
      <div class="flex items-center gap-2">
        <button
          hlmBtn
          variant="outline"
          size="lg"
          (click)="changePeople(1)"
          aria-label="Add split"
          aria-controls="people-count"
        >+</button>
        <span class="text-sm text-muted-foreground">Add split</span>
      </div>
    }
  </div>

  <!-- Live region -->
  <p aria-live="polite" class="sr-only">
    Total {{ totalRounded() | currency }}.
    @if (people() > 1) { {{ people() }} people. Per person {{ perPerson() | currency }}. }
  </p>
</div>
